"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4288],{4288:(e,n,i)=>{i.r(n),i.d(n,{default:()=>p});var s=i(2483),t=i(3376),o=i(5296),r=i(9859),d=i(1458),a=i(6723);const l=async e=>(await d.A.get(`/api/v1/admin/chat/session/${e}`)).data,c=async(e,n,i)=>(await d.A.post(`/api/v1/admin/chat/end/${e}`,{adminId:n,reason:i})).data,p=()=>{const{sessionId:e}=(0,t.g)(),{socket:n,isConnected:i}=(0,o.Y)(),[d]=(0,r.A)(),p=null===d||void 0===d?void 0:d.user,[x,f]=(0,s.useState)(null),[u,m]=(0,s.useState)([]),[g,h]=(0,s.useState)(""),[y,v]=(0,s.useState)(!1),[b,j]=(0,s.useState)(!1),[w,C]=(0,s.useState)("connecting"),[k,I]=(0,s.useState)(!1),[S,T]=(0,s.useState)(null),[_,z]=(0,s.useState)(!0),[R,D]=(0,s.useState)(null),F=(0,s.useRef)(null),B=(0,s.useRef)(null),E=(0,s.useRef)(null),N=(0,s.useCallback)(function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!e)return"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300";return"string"===typeof e&&e.startsWith("/uploads/userAvatars/")?`http://localhost:8000${e}`:e},[]),$=(0,s.useCallback)(e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[]),U=(0,s.useCallback)(async()=>{if(e&&p){z(!0),D(null);try{const i=await l(e);if(i.success){const{session:e,messages:s,userInfo:t}=i.data;f(e),m(s||[]),T(t),I("active"===(null===e||void 0===e?void 0:e.status)),C("connected"),null!==n&&void 0!==n&&n.connected&&n.emit("admin:join_session",{sessionId:e._id,adminId:p._id})}else D("Failed to load chat session")}catch(t){var i,s;console.error("Error loading session:",t),D((null===(i=t.response)||void 0===i||null===(s=i.data)||void 0===s?void 0:s.message)||"Failed to load chat session")}finally{z(!1)}}},[e,p,n]);(0,s.useEffect)(()=>{if(!n||!e)return;const i=n=>{n.sessionId===e&&m(e=>e.some(e=>e._id===n._id)?e:[...e,n])},s=n=>{n.sessionId===e&&"user"===n.userType&&j(n.isTyping)},t=n=>{n.sessionId===e&&(I(!1),C("ended"))};return n.on("message:new",i),n.on("user:typing",s),n.on("session:ended",t),()=>{n.off("message:new",i),n.off("user:typing",s),n.off("session:ended",t)}},[n,e]);const W=(0,s.useCallback)(()=>{n&&e&&(v(!0),n.emit("admin:typing",{sessionId:e,adminId:p._id,isTyping:!0}),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{v(!1),n.emit("admin:typing",{sessionId:e,adminId:p._id,isTyping:!1})},1e3))},[n,e,p]),A=(0,s.useCallback)(async()=>{if(!g.trim()||!n||!e)return;const i=g.trim(),s={_id:`temp_${Date.now()}`,sessionId:e,message:i,senderType:"agent",senderId:p._id,senderName:`${p.firstname} ${p.lastname}`,timestamp:new Date,status:"sending"};m(e=>[...e,s]),h(""),v(!1),n.emit("admin:typing",{sessionId:e,adminId:p._id,isTyping:!1});try{var t;n.emit("admin:send_message",{sessionId:e,message:i,adminId:p._id,messageType:"text"}),null===(t=E.current)||void 0===t||t.focus()}catch(R){console.error("Error sending message:",R),m(e=>e.filter(e=>e._id!==s._id))}},[g,n,e,p]),H=(0,s.useCallback)(e=>{h(e.target.value),W()},[W]),L=(0,s.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),A())},[A]),Y=(0,s.useCallback)(async()=>{if(e&&n)try{n.emit("admin:end_session",{sessionId:e,adminId:p._id}),await c(e,p._id,"ended_by_agent"),I(!1),C("ended")}catch(R){console.error("Error ending session:",R)}},[e,n,p]);(0,s.useEffect)(()=>{var e;null===(e=F.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[u]),(0,s.useEffect)(()=>{U()},[U]);const K=(0,s.useMemo)(()=>{switch(w){case"connecting":return{icon:"\ud83d\udd04",text:"Connecting...",color:"#ffa500"};case"connected":return{icon:"\ud83d\udfe2",text:"Connected",color:"#4caf50"};case"ended":return{icon:"\ud83d\udd34",text:"Session Ended",color:"#f44336"};default:return{icon:"\u26aa",text:"Unknown",color:"#9e9e9e"}}},[w]);return _?(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,a.jsx)("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #007bff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"20px"}}),(0,a.jsx)("p",{style:{color:"#666",fontSize:"16px"},children:"Loading chat session..."})]}):R?(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"system-ui, -apple-system, sans-serif",color:"#333"},children:[(0,a.jsx)("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"\u26a0\ufe0f"}),(0,a.jsx)("h3",{style:{marginBottom:"10px",color:"#d32f2f"},children:"Failed to Load Chat Session"}),(0,a.jsx)("p",{style:{color:"#666",marginBottom:"20px"},children:R}),(0,a.jsx)("button",{onClick:()=>window.history.back(),style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Back to Chat List"})]}):(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100vh",fontFamily:"system-ui, -apple-system, sans-serif",backgroundColor:"#f8f9fa"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 24px",backgroundColor:"white",borderBottom:"1px solid #e9ecef",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,a.jsx)("button",{onClick:()=>window.history.back(),style:{padding:"8px",backgroundColor:"transparent",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"16px",color:"#6c757d"},children:"\u2190"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,a.jsx)("img",{src:N(null===S||void 0===S?void 0:S.photo,!(null!==S&&void 0!==S&&S.userId)),alt:"User",style:{width:"48px",height:"48px",borderRadius:"50%",objectFit:"cover"}}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#212529"},children:[(null===S||void 0===S?void 0:S.firstName)||(null===S||void 0===S?void 0:S.firstname)||"Guest User"," ",(null===S||void 0===S?void 0:S.lastName)||(null===S||void 0===S?void 0:S.lastname)||""]}),(0,a.jsx)("p",{style:{margin:0,fontSize:"14px",color:"#6c757d"},children:(null===S||void 0===S?void 0:S.email)||"No email provided"})]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",backgroundColor:"#f8f9fa",borderRadius:"20px",fontSize:"14px"},children:[(0,a.jsx)("span",{style:{fontSize:"12px"},children:K.icon}),(0,a.jsx)("span",{style:{color:K.color,fontWeight:"500"},children:K.text})]}),k&&(0,a.jsx)("button",{onClick:Y,style:{padding:"8px 16px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"\ud83d\udcde End Session"})]})]}),(0,a.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"24px",display:"flex",flexDirection:"column",gap:"16px"},children:[0===u.length?(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#6c757d"},children:[(0,a.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\ud83d\udcac"}),(0,a.jsx)("p",{style:{fontSize:"16px",margin:0},children:"No messages yet. Start the conversation!"})]}):u.map((e,n)=>(0,a.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"16px",flexDirection:"agent"===e.senderType?"row-reverse":"row"},children:[(0,a.jsx)("img",{src:"agent"===e.senderType?N(null===p||void 0===p?void 0:p.photo):N(null===S||void 0===S?void 0:S.photo,!(null!==S&&void 0!==S&&S.userId)),alt:"agent"===e.senderType?"Admin":"User",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover",flexShrink:0}}),(0,a.jsxs)("div",{style:{maxWidth:"70%",display:"flex",flexDirection:"column",gap:"4px"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px",color:"#6c757d",justifyContent:"agent"===e.senderType?"flex-end":"flex-start"},children:[(0,a.jsx)("span",{style:{fontWeight:"500"},children:"agent"===e.senderType?e.senderName||`${p.firstname} ${p.lastname}`:`${(null===S||void 0===S?void 0:S.firstName)||(null===S||void 0===S?void 0:S.firstname)||"User"}`}),(0,a.jsx)("span",{children:$(e.timestamp||e.createdAt)}),"sending"===e.status&&(0,a.jsx)("span",{style:{color:"#ffc107"},children:"\u23f3"})]}),(0,a.jsx)("div",{style:{padding:"12px 16px",borderRadius:"18px",backgroundColor:"agent"===e.senderType?"#007bff":"#f8f9fa",color:"agent"===e.senderType?"white":"#212529",fontSize:"14px",lineHeight:"1.4",wordWrap:"break-word"},children:e.message})]})]},e._id||n)),b&&(0,a.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"16px"},children:[(0,a.jsx)("img",{src:N(null===S||void 0===S?void 0:S.photo,!(null!==S&&void 0!==S&&S.userId)),alt:"User",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover"}}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,a.jsxs)("span",{style:{fontSize:"12px",color:"#6c757d",fontStyle:"italic"},children:[(null===S||void 0===S?void 0:S.firstName)||"User"," is typing..."]}),(0,a.jsxs)("div",{style:{padding:"12px 16px",borderRadius:"18px",backgroundColor:"#f8f9fa",display:"flex",gap:"4px",alignItems:"center"},children:[(0,a.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#6c757d",animation:"bounce 1.4s ease-in-out infinite both"}}),(0,a.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#6c757d",animation:"bounce 1.4s ease-in-out 0.16s infinite both"}}),(0,a.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#6c757d",animation:"bounce 1.4s ease-in-out 0.32s infinite both"}})]})]})]}),(0,a.jsx)("div",{ref:F})]}),(0,a.jsx)("div",{style:{padding:"16px 24px",backgroundColor:"white",borderTop:"1px solid #e9ecef"},children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",gap:"12px",marginBottom:"8px"},children:[(0,a.jsx)("div",{style:{flex:1,position:"relative"},children:(0,a.jsx)("textarea",{ref:E,value:g,onChange:H,onKeyPress:L,placeholder:"Type your message...",style:{width:"100%",minHeight:"44px",maxHeight:"120px",padding:"12px 16px",border:"2px solid #e9ecef",borderRadius:"22px",fontSize:"14px",fontFamily:"inherit",resize:"none",outline:"none",transition:"border-color 0.2s ease",backgroundColor:i?"white":"#f8f9fa"},rows:1,disabled:!i,onFocus:e=>e.target.style.borderColor="#007bff",onBlur:e=>e.target.style.borderColor="#e9ecef"})}),(0,a.jsx)("button",{onClick:A,disabled:!g.trim()||!i,style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:g.trim()&&i?"#007bff":"#e9ecef",color:g.trim()&&i?"white":"#6c757d",border:"none",cursor:g.trim()&&i?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",transition:"all 0.2s ease",flexShrink:0},children:"\u2708\ufe0f"})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"12px",color:"#6c757d",minHeight:"16px"},children:[(0,a.jsx)("div",{children:y&&(0,a.jsx)("span",{style:{fontStyle:"italic"},children:"You are typing..."})}),(0,a.jsx)("div",{children:!i&&(0,a.jsx)("span",{style:{color:"#dc3545",display:"flex",alignItems:"center",gap:"4px"},children:"\ud83d\udcf6 Connection lost. Trying to reconnect..."})})]})]}):(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",backgroundColor:"#f8f9fa",borderRadius:"8px",color:"#6c757d",fontSize:"14px",gap:"8px"},children:[(0,a.jsx)("span",{children:"\u2139\ufe0f"}),(0,a.jsx)("span",{children:"This chat session has ended. No new messages can be sent."})]})}),(0,a.jsx)("style",{jsx:!0,children:"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n        \n        @keyframes bounce {\n          0%, 80%, 100% {\n            transform: scale(0);\n          } 40% {\n            transform: scale(1);\n          }\n        }\n        \n        /* Responsive Design */\n        @media (max-width: 768px) {\n          .admin-chat-header {\n            padding: 12px 16px !important;\n          }\n          \n          .admin-chat-messages {\n            padding: 16px !important;\n          }\n          \n          .admin-chat-input {\n            padding: 12px 16px !important;\n          }\n          \n          .user-details h3 {\n            font-size: 16px !important;\n          }\n          \n          .user-details p {\n            font-size: 12px !important;\n          }\n        }\n        \n        @media (max-width: 480px) {\n          .header-right {\n            flex-direction: column !important;\n            gap: 8px !important;\n          }\n          \n          .connection-status {\n            font-size: 12px !important;\n          }\n          \n          .message {\n            margin-bottom: 12px !important;\n          }\n          \n          .message-content {\n            max-width: 85% !important;\n          }\n        }\n      "})]})}}}]);
//# sourceMappingURL=4288.37b4fd20.chunk.js.map