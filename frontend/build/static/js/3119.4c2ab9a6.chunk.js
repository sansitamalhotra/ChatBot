"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3119],{3119:(s,e,a)=>{a.r(e),a.d(e,{default:()=>r});var i=a(2483),t=a(3376),n=a(9859),l=a(5296),o=a(1458),c=a(6723);const r=()=>{const s=(0,t.Zp)(),{socket:e,isConnected:a}=(0,l.Y)(),[r]=(0,n.A)(),d=null===r||void 0===r?void 0:r.user,[u,v]=(0,i.useState)([]),[m,h]=(0,i.useState)([]),[f,g]=(0,i.useState)(!0),[p,x]=(0,i.useState)(null),[j,N]=(0,i.useState)("all"),[w,C]=(0,i.useState)(""),[b,S]=(0,i.useState)({totalSessions:0,activeSessions:0,waitingSessions:0}),k=(0,i.useCallback)(function(s){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!s)return"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300";return"string"===typeof s&&s.startsWith("/uploads/userAvatars/")?`http://localhost:8000${s}`:s},[]),y=(0,i.useCallback)(s=>{const e=Date.now()-new Date(s).getTime(),a=Math.floor(e/6e4),i=Math.floor(a/60),t=Math.floor(i/24);return t>0?`${t}d ago`:i>0?`${i}h ago`:a>0?`${a}m ago`:"Just now"},[]),A=(0,i.useCallback)(async()=>{g(!0),x(null);try{const s=await o.A.get("/api/v1/admin/chat/sessions");if(s.data.success){const{sessions:e,totalSessions:a,activeSessions:i,waitingSessions:t}=s.data.data;v(e||[]),S({totalSessions:a||0,activeSessions:i||0,waitingSessions:t||0})}else x("Failed to load chat sessions")}catch(n){var e,a;if(console.error("Error loading sessions:",n),404===(null===(e=n.response)||void 0===e?void 0:e.status))x("Chat feature not available. Please contact administrator.");else if(401===(null===(a=n.response)||void 0===a?void 0:a.status))x("Authentication failed. Please login again."),s("/Admin/Dashboard");else{var i,t;x((null===(i=n.response)||void 0===i||null===(t=i.data)||void 0===t?void 0:t.message)||"Failed to load chat sessions")}}finally{g(!1)}},[s]);(0,i.useEffect)(()=>{!d||1!==d.role&&0!==d.role?s("/Admin/Dashboard"):A()},[d,A,s]),(0,i.useEffect)(()=>{let s=u;if("all"!==j&&(s=s.filter(s=>s.status===j)),w.trim()){const e=w.toLowerCase();s=s.filter(s=>{var a,i,t,n,l,o,c,r;return(null===(a=s.userInfo)||void 0===a||null===(i=a.firstName)||void 0===i?void 0:i.toLowerCase().includes(e))||(null===(t=s.userInfo)||void 0===t||null===(n=t.lastName)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(l=s.userInfo)||void 0===l||null===(o=l.email)||void 0===o?void 0:o.toLowerCase().includes(e))||(null===(c=s.lastMessage)||void 0===c||null===(r=c.message)||void 0===r?void 0:r.toLowerCase().includes(e))})}h(s)},[u,j,w]),(0,i.useEffect)(()=>{if(!e)return;const s=s=>{v(e=>[s,...e]),S(s=>({...s,totalSessions:s.totalSessions+1,waitingSessions:s.waitingSessions+1}))},a=s=>{v(e=>e.map(e=>e._id===s._id?s:e))},i=s=>{v(e=>e.map(e=>e._id===s.sessionId?{...e,lastMessage:s,unreadCount:e.unreadCount+("user"===s.senderType?1:0)}:e))};return e.on("admin:new_session",s),e.on("admin:session_updated",a),e.on("message:new",i),()=>{e.off("admin:new_session",s),e.off("admin:session_updated",a),e.off("message:new",i)}},[e]);const _=(0,i.useCallback)(async e=>{try{(await o.A.post(`/api/v1/admin/chat/assign/${e}`,{adminId:d._id})).data.success&&(v(s=>s.map(s=>s._id===e?{...s,status:"active",agent:d}:s)),s(`/admin/chat/session/${e}`))}catch(p){console.error("Error assigning session:",p),x("Failed to assign session")}},[d,s]),I=(0,i.useCallback)(e=>{s(`/admin/chat/session/${e}`)},[s]),$=(0,i.useCallback)(s=>{switch(s){case"active":return"status-active";case"waiting":return"status-waiting";case"ended":return"status-ended";default:return"status-default"}},[]),M=(0,i.useCallback)(s=>{switch(s){case"active":return"indicator-active";case"waiting":return"indicator-waiting";case"ended":return"indicator-ended";default:return"indicator-default"}},[]),L=[{value:"all",label:"All Sessions",count:b.totalSessions},{value:"waiting",label:"Waiting",count:b.waitingSessions},{value:"active",label:"Active",count:b.activeSessions},{value:"ended",label:"Ended",count:b.totalSessions-b.activeSessions-b.waitingSessions}];return f?(0,c.jsxs)("div",{className:"loading-container",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{className:"loading-text",children:"Loading chat sessions..."})]}):(0,c.jsxs)("div",{className:"admin-chat-list-container",children:[(0,c.jsxs)("div",{className:"header-container",children:[(0,c.jsxs)("div",{className:"header-top",children:[(0,c.jsx)("h1",{className:"header-title",children:"Live Chat Management"}),(0,c.jsxs)("button",{onClick:A,className:"refresh-button",children:[(0,c.jsx)("i",{className:"fas fa-sync-alt"})," Refresh"]})]}),(0,c.jsx)("div",{className:"stats-grid",children:[{label:"Total Sessions",value:b.totalSessions,colorClass:"stats-total",icon:"fas fa-comments"},{label:"Active Chats",value:b.activeSessions,colorClass:"stats-active",icon:"fas fa-circle"},{label:"Waiting for Agent",value:b.waitingSessions,colorClass:"stats-waiting",icon:"fas fa-clock"},{label:"Connection Status",value:a?"Online":"Offline",colorClass:a?"stats-online":"stats-offline",icon:a?"fas fa-wifi":"fas fa-wifi-slash"}].map((s,e)=>(0,c.jsxs)("div",{className:"stats-card",children:[(0,c.jsx)("div",{className:`stats-icon ${s.colorClass}`,children:(0,c.jsx)("i",{className:s.icon})}),(0,c.jsx)("div",{className:`stats-value ${s.colorClass}`,children:s.value}),(0,c.jsx)("div",{className:"stats-label",children:s.label})]},e))}),(0,c.jsxs)("div",{className:"filters-container",children:[(0,c.jsx)("div",{className:"filter-buttons",children:L.map(s=>(0,c.jsxs)("button",{onClick:()=>N(s.value),className:"filter-button "+(j===s.value?"active":""),children:[s.label," (",s.count,")"]},s.value))}),(0,c.jsx)("input",{type:"text",placeholder:"Search sessions...",value:w,onChange:s=>C(s.target.value),className:"search-input"})]})]}),(0,c.jsxs)("div",{className:"sessions-content",children:[p&&(0,c.jsxs)("div",{className:"error-message",children:[(0,c.jsx)("i",{className:"fas fa-exclamation-triangle error-icon"}),p]}),0===m.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-icon",children:(0,c.jsx)("i",{className:"fas fa-comments"})}),(0,c.jsx)("h3",{className:"empty-title",children:"No chat sessions found"}),(0,c.jsx)("p",{className:"empty-description",children:w?"Try adjusting your search terms":"Chat sessions will appear here when users start conversations"})]}):(0,c.jsx)("div",{className:"sessions-grid",children:m.map(s=>{var e,a,i,t,n,l,o,r;return(0,c.jsx)("div",{className:"session-card",onClick:()=>I(s._id),children:(0,c.jsxs)("div",{className:"session-content",children:[(0,c.jsxs)("div",{className:"user-avatar-container",children:[(0,c.jsx)("img",{src:k(null===(e=s.userInfo)||void 0===e?void 0:e.photo,!(null!==(a=s.userInfo)&&void 0!==a&&a.userId)),alt:"User",className:"user-avatar"}),(0,c.jsx)("div",{className:`status-indicator ${M(s.status)}`})]}),(0,c.jsxs)("div",{className:"session-details",children:[(0,c.jsxs)("div",{className:"session-header",children:[(0,c.jsxs)("div",{className:"user-info",children:[(0,c.jsxs)("h3",{children:[(null===(i=s.userInfo)||void 0===i?void 0:i.firstName)||"Guest User"," ",(null===(t=s.userInfo)||void 0===t?void 0:t.lastName)||""]}),(0,c.jsx)("p",{children:(null===(n=s.userInfo)||void 0===n?void 0:n.email)||"No email provided"})]}),(0,c.jsxs)("div",{className:"session-meta",children:[s.unreadCount>0&&(0,c.jsx)("span",{className:"unread-count",children:s.unreadCount}),(0,c.jsx)("span",{className:`status-badge ${$(s.status)}`,children:s.status}),(0,c.jsx)("span",{className:"timestamp",children:y((null===(l=s.lastMessage)||void 0===l?void 0:l.timestamp)||s.createdAt)})]})]}),(0,c.jsx)("div",{className:"last-message",children:(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"user"===(null===(o=s.lastMessage)||void 0===o?void 0:o.senderType)?"User: ":"Agent: "}),(null===(r=s.lastMessage)||void 0===r?void 0:r.message)||"No messages yet"]})}),(0,c.jsxs)("div",{className:"session-footer",children:[(0,c.jsxs)("div",{className:"session-info",children:[(0,c.jsxs)("span",{children:[(0,c.jsx)("i",{className:"fas fa-calendar-alt"}),new Date(s.createdAt).toLocaleDateString()]}),s.agent&&(0,c.jsxs)("span",{children:[(0,c.jsx)("i",{className:"fas fa-user"}),s.agent.firstname," ",s.agent.lastname]})]}),(0,c.jsxs)("div",{className:"session-actions",children:["waiting"===s.status&&(0,c.jsxs)("button",{onClick:e=>{e.stopPropagation(),_(s._id)},className:"action-button take-session-button",children:[(0,c.jsx)("i",{className:"fas fa-hand-paper"})," Take Session"]}),(0,c.jsxs)("button",{onClick:e=>{e.stopPropagation(),I(s._id)},className:"action-button open-chat-button",children:[(0,c.jsx)("i",{className:"fas fa-comments"})," Open Chat"]})]})]})]})]})},s._id)})})]})]})}}}]);
//# sourceMappingURL=3119.4c2ab9a6.chunk.js.map