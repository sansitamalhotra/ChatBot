"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1234],{1234:(s,e,a)=>{a.r(e),a.d(e,{default:()=>c});var n=a(2483),i=a(3376),t=a(9859),l=a(5296),o=a(1458),d=a(6723);const c=()=>{const{sessionId:s}=(0,i.g)(),e=(0,i.Zp)(),{socket:a,isConnected:c}=(0,l.Y)(),[r]=(0,t.A)(),m=null===r||void 0===r?void 0:r.user,u=(0,n.useRef)(null),[h,v]=(0,n.useState)(null),[f,g]=(0,n.useState)([]),[p,x]=(0,n.useState)(""),[j,N]=(0,n.useState)(!0),[b,y]=(0,n.useState)(!1),[w,C]=(0,n.useState)(null),[I,k]=(0,n.useState)(null),[A,E]=(0,n.useState)(!1),[S,_]=(0,n.useState)("connecting"),T=(0,n.useCallback)(()=>{var s;null===(s=u.current)||void 0===s||s.scrollIntoView({behavior:"smooth"})},[]),L=(0,n.useCallback)(async()=>{if(s){N(!0),C(null);try{const e=await o.A.get(`/api/v1/admin/chat/session/${s}`);if(e.data.success){const{session:s,messages:a,userInfo:n}=e.data.data;v(s),g(a||[]),k(n||s.userInfo),_("connected")}else C("Failed to load chat session")}catch(t){var e,a;if(console.error("Error loading session:",t),404===(null===(e=t.response)||void 0===e?void 0:e.status))C("Chat session not found");else if(403===(null===(a=t.response)||void 0===a?void 0:a.status))C("Access denied to this chat session");else{var n,i;C((null===(n=t.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Failed to load chat session")}}finally{N(!1)}}},[s]);(0,n.useEffect)(()=>{!m||1!==m.role&&0!==m.role?e("/Admin/Dashboard"):s?L():C("No session ID provided")},[m,s,L,e]),(0,n.useEffect)(()=>{h&&m&&(async()=>{if(h&&"waiting"===h.status&&(!h.agentId||h.agentId!==m._id))try{await o.A.post(`/api/v1/admin/chat/assign/${s}`,{adminId:m._id}),L()}catch(w){console.error("Error auto-assigning session:",w)}})()},[h,m,s,L]),(0,n.useEffect)(()=>{if(!a||!s)return;a.emit("admin:join_session",{sessionId:s,adminId:m._id});const e=e=>{e.sessionId===s&&(g(s=>[...s,e]),T())},n=e=>{e._id===s&&v(e)},i=e=>{e.sessionId===s&&E(e.isTyping)};return a.on("message:new",e),a.on("session:updated",n),a.on("user:typing",i),()=>{a.off("message:new",e),a.off("session:updated",n),a.off("user:typing",i),a.emit("admin:leave_session",{sessionId:s,adminId:m._id})}},[a,s,m,T]),(0,n.useEffect)(()=>{T()},[f,T]);const D=(0,n.useCallback)(async e=>{if(e.preventDefault(),!p.trim()||b)return;const a=p.trim();x(""),y(!0);try{const e="User",n=await o.A.post("/api/v1/admin/chat/message",{sessionId:s,message:a,senderType:"agent",senderId:m._id,senderModel:e});if(!n.data.success)throw new Error(n.data.message||"Failed to send message");console.log("Message sent successfully")}catch(w){var n,i;console.error("Error sending message:",w);const e=(null===(n=w.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||w.message||"Failed to send message";C(e),x(a)}finally{y(!1)}},[p,b,s,m]),F=(0,n.useCallback)(async()=>{if(window.confirm("Are you sure you want to end this chat session?"))try{(await o.A.post(`/api/v1/admin/chat/end/${s}`,{reason:"ended_by_agent"})).data.success&&v(s=>({...s,status:"ended"}))}catch(w){console.error("Error ending session:",w),C("Failed to end session")}},[s]),$=(0,n.useCallback)(function(s){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!s)return"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300";return"string"===typeof s&&s.startsWith("/uploads/userAvatars/")?`http://localhost:8000${s}`:s},[]),U=(0,n.useCallback)(s=>{try{const e=new Date(s);return isNaN(e.getTime())?(console.warn("Invalid date:",s),"Invalid time"):e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}catch(w){return console.error("Error formatting time:",w),"Invalid time"}},[]);return j?(0,d.jsxs)("div",{className:"loading-container",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{className:"loading-text",children:"Loading chat session..."})]}):w?(0,d.jsx)("div",{className:"error-container",children:(0,d.jsxs)("div",{className:"error-content",children:[(0,d.jsx)("i",{className:"fas fa-exclamation-triangle error-icon"}),(0,d.jsx)("h3",{children:"Error Loading Chat"}),(0,d.jsx)("p",{children:w}),(0,d.jsx)("button",{onClick:()=>{C(null),L()},className:"btn btn-secondary mr-2",children:"Retry"}),(0,d.jsx)("button",{onClick:()=>e("/Admin/Chat-List"),className:"btn btn-primary",children:"Back to Chat List"})]})}):(0,d.jsxs)("div",{className:"admin-live-chat-container",children:[(0,d.jsxs)("div",{className:"chat-header",children:[(0,d.jsxs)("div",{className:"chat-header-left",children:[(0,d.jsx)("button",{onClick:()=>e("/Admin/Chat-List"),className:"back-button",children:(0,d.jsx)("i",{className:"fas fa-arrow-left"})}),(0,d.jsxs)("div",{className:"user-avatar",children:[(0,d.jsx)("img",{src:$(null===I||void 0===I?void 0:I.photo,!(null!==I&&void 0!==I&&I.userId)),alt:"User",className:"avatar-img"}),(0,d.jsx)("div",{className:"status-indicator "+("active"===(null===h||void 0===h?void 0:h.status)?"online":"offline")})]}),(0,d.jsxs)("div",{className:"user-details",children:[(0,d.jsxs)("h3",{className:"user-name",children:[(null===I||void 0===I?void 0:I.firstName)||(null===I||void 0===I?void 0:I.firstname)||"Guest User"," ",(null===I||void 0===I?void 0:I.lastName)||(null===I||void 0===I?void 0:I.lastname)||""]}),(0,d.jsx)("p",{className:"user-status",children:(null===I||void 0===I?void 0:I.email)||"No email provided"})]})]}),(0,d.jsxs)("div",{className:"chat-header-right",children:[(0,d.jsxs)("div",{className:"connection-status",children:[(0,d.jsx)("i",{className:"fas "+(c?"fa-wifi":"fa-wifi-slash")}),(0,d.jsx)("span",{children:c?"Connected":"Disconnected"})]}),(0,d.jsxs)("div",{className:"session-info",children:[(0,d.jsx)("span",{className:`status-badge status-${null===h||void 0===h?void 0:h.status}`,children:null===h||void 0===h?void 0:h.status}),(0,d.jsxs)("span",{className:"session-id",children:["#",s.slice(-6)]})]}),"ended"!==(null===h||void 0===h?void 0:h.status)&&(0,d.jsxs)("button",{onClick:F,className:"end-session-button",children:[(0,d.jsx)("i",{className:"fas fa-times"}),"End Chat"]})]})]}),(0,d.jsx)("div",{className:"chat-messages",children:(0,d.jsxs)("div",{className:"messages-list",children:[f.map(s=>(0,d.jsx)("div",{className:"message "+("agent"===s.senderType?"message-sent":"message-received"),children:(0,d.jsxs)("div",{className:"message-content",children:[(0,d.jsx)("div",{className:"message-text",children:s.message}),(0,d.jsx)("div",{className:"message-time",children:U(s.createdAt||s.timestamp)})]})},s._id)),A&&(0,d.jsx)("div",{className:"message message-received typing-indicator",children:(0,d.jsx)("div",{className:"message-content",children:(0,d.jsxs)("div",{className:"typing-dots",children:[(0,d.jsx)("span",{}),(0,d.jsx)("span",{}),(0,d.jsx)("span",{})]})})}),(0,d.jsx)("div",{ref:u})]})}),(0,d.jsx)("div",{className:"chat-input-container",children:"ended"===(null===h||void 0===h?void 0:h.status)?(0,d.jsxs)("div",{className:"session-ended-notice",children:[(0,d.jsx)("i",{className:"fas fa-info-circle"}),"This chat session has ended"]}):(0,d.jsxs)("form",{onSubmit:D,className:"chat-input-form",children:[(0,d.jsxs)("div",{className:"input-group",children:[(0,d.jsx)("input",{type:"text",value:p,onChange:s=>x(s.target.value),placeholder:"Type your message...",className:"message-input",disabled:b||!c}),(0,d.jsx)("button",{type:"submit",disabled:!p.trim()||b||!c,className:"send-button",children:b?(0,d.jsx)("i",{className:"fas fa-spinner fa-spin"}):(0,d.jsx)("i",{className:"fas fa-paper-plane"})})]}),(0,d.jsxs)("div",{className:"input-status",children:[!c&&(0,d.jsxs)("span",{className:"connection-warning",children:[(0,d.jsx)("i",{className:"fas fa-exclamation-triangle"}),"Connection lost - messages may not be delivered"]}),w&&(0,d.jsxs)("span",{className:"error-warning",children:[(0,d.jsx)("i",{className:"fas fa-exclamation-circle"}),w,(0,d.jsx)("button",{onClick:()=>C(null),className:"error-dismiss",type:"button",children:"\xd7"})]})]})]})})]})}}}]);
//# sourceMappingURL=1234.782bcfc8.chunk.js.map