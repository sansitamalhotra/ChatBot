"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3119],{3119:(s,e,a)=>{a.r(e),a.d(e,{default:()=>d});var t=a(9379),i=a(2483),n=a(3376),l=a(9859),o=a(5296),c=a(8054),r=a(6723);const d=()=>{const s=(0,n.Zp)(),{socket:e,isConnected:a}=(0,o.Y)(),[d]=(0,l.A)(),u=null===d||void 0===d?void 0:d.user,[v,m]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),[g,p]=(0,i.useState)(!0),[x,j]=(0,i.useState)(null),[N,w]=(0,i.useState)("all"),[C,b]=(0,i.useState)(""),[S,k]=(0,i.useState)({totalSessions:0,activeSessions:0,waitingSessions:0}),A=(0,i.useCallback)(function(s){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!s)return"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300";return"string"===typeof s&&s.startsWith("/uploads/userAvatars/")?"".concat("http://localhost:8000/").concat(s):s},[]),y=(0,i.useCallback)(s=>{const e=Date.now()-new Date(s).getTime(),a=Math.floor(e/6e4),t=Math.floor(a/60),i=Math.floor(t/24);return i>0?"".concat(i,"d ago"):t>0?"".concat(t,"h ago"):a>0?"".concat(a,"m ago"):"Just now"},[]),_=(0,i.useCallback)(async()=>{p(!0),j(null);try{const s=await c.A.get("/api/v1/admin/chat/sessions");if(s.data.success){const{sessions:e,totalSessions:a,activeSessions:t,waitingSessions:i}=s.data.data;m(e||[]),k({totalSessions:a||0,activeSessions:t||0,waitingSessions:i||0})}else j("Failed to load chat sessions")}catch(n){var e,a;if(console.error("Error loading sessions:",n),404===(null===(e=n.response)||void 0===e?void 0:e.status))j("Chat feature not available. Please contact administrator.");else if(401===(null===(a=n.response)||void 0===a?void 0:a.status))j("Authentication failed. Please login again."),s("/Admin/Dashboard");else{var t,i;j((null===(t=n.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message)||"Failed to load chat sessions")}}finally{p(!1)}},[s]);(0,i.useEffect)(()=>{!u||1!==u.role&&0!==u.role?s("/Admin/Dashboard"):_()},[u,_,s]),(0,i.useEffect)(()=>{let s=v;if("all"!==N&&(s=s.filter(s=>s.status===N)),C.trim()){const e=C.toLowerCase();s=s.filter(s=>{var a,t,i,n,l,o,c,r;return(null===(a=s.userInfo)||void 0===a||null===(t=a.firstName)||void 0===t?void 0:t.toLowerCase().includes(e))||(null===(i=s.userInfo)||void 0===i||null===(n=i.lastName)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(l=s.userInfo)||void 0===l||null===(o=l.email)||void 0===o?void 0:o.toLowerCase().includes(e))||(null===(c=s.lastMessage)||void 0===c||null===(r=c.message)||void 0===r?void 0:r.toLowerCase().includes(e))})}f(s)},[v,N,C]),(0,i.useEffect)(()=>{if(!e)return;const s=s=>{m(e=>[s,...e]),k(s=>(0,t.A)((0,t.A)({},s),{},{totalSessions:s.totalSessions+1,waitingSessions:s.waitingSessions+1}))},a=s=>{m(e=>e.map(e=>e._id===s._id?s:e))},i=s=>{m(e=>e.map(e=>e._id===s.sessionId?(0,t.A)((0,t.A)({},e),{},{lastMessage:s,unreadCount:e.unreadCount+("user"===s.senderType?1:0)}):e))};return e.on("admin:new_session",s),e.on("admin:session_updated",a),e.on("message:new",i),()=>{e.off("admin:new_session",s),e.off("admin:session_updated",a),e.off("message:new",i)}},[e]);const I=(0,i.useCallback)(async e=>{try{(await c.A.post("/api/v1/admin/chat/assign/".concat(e),{adminId:u._id})).data.success&&(m(s=>s.map(s=>s._id===e?(0,t.A)((0,t.A)({},s),{},{status:"active",agent:u}):s)),s("/admin/chat/session/".concat(e)))}catch(x){console.error("Error assigning session:",x),j("Failed to assign session")}},[u,s]),M=(0,i.useCallback)(e=>{s("/admin/chat/session/".concat(e))},[s]),L=(0,i.useCallback)(s=>{switch(s){case"active":return"status-active";case"waiting":return"status-waiting";case"ended":return"status-ended";default:return"status-default"}},[]),D=(0,i.useCallback)(s=>{switch(s){case"active":return"indicator-active";case"waiting":return"indicator-waiting";case"ended":return"indicator-ended";default:return"indicator-default"}},[]),E=[{value:"all",label:"All Sessions",count:S.totalSessions},{value:"waiting",label:"Waiting",count:S.waitingSessions},{value:"active",label:"Active",count:S.activeSessions},{value:"ended",label:"Ended",count:S.totalSessions-S.activeSessions-S.waitingSessions}];return g?(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{className:"loading-text",children:"Loading chat sessions..."})]}):(0,r.jsxs)("div",{className:"admin-chat-list-container",children:[(0,r.jsxs)("div",{className:"header-container",children:[(0,r.jsxs)("div",{className:"header-top",children:[(0,r.jsx)("h1",{className:"header-title",children:"Live Chat Management"}),(0,r.jsxs)("button",{onClick:_,className:"refresh-button",children:[(0,r.jsx)("i",{className:"fas fa-sync-alt"})," Refresh"]})]}),(0,r.jsx)("div",{className:"stats-grid",children:[{label:"Total Sessions",value:S.totalSessions,colorClass:"stats-total",icon:"fas fa-comments"},{label:"Active Chats",value:S.activeSessions,colorClass:"stats-active",icon:"fas fa-circle"},{label:"Waiting for Agent",value:S.waitingSessions,colorClass:"stats-waiting",icon:"fas fa-clock"},{label:"Connection Status",value:a?"Online":"Offline",colorClass:a?"stats-online":"stats-offline",icon:a?"fas fa-wifi":"fas fa-wifi-slash"}].map((s,e)=>(0,r.jsxs)("div",{className:"stats-card",children:[(0,r.jsx)("div",{className:"stats-icon ".concat(s.colorClass),children:(0,r.jsx)("i",{className:s.icon})}),(0,r.jsx)("div",{className:"stats-value ".concat(s.colorClass),children:s.value}),(0,r.jsx)("div",{className:"stats-label",children:s.label})]},e))}),(0,r.jsxs)("div",{className:"filters-container",children:[(0,r.jsx)("div",{className:"filter-buttons",children:E.map(s=>(0,r.jsxs)("button",{onClick:()=>w(s.value),className:"filter-button ".concat(N===s.value?"active":""),children:[s.label," (",s.count,")"]},s.value))}),(0,r.jsx)("input",{type:"text",placeholder:"Search sessions...",value:C,onChange:s=>b(s.target.value),className:"search-input"})]})]}),(0,r.jsxs)("div",{className:"sessions-content",children:[x&&(0,r.jsxs)("div",{className:"error-message",children:[(0,r.jsx)("i",{className:"fas fa-exclamation-triangle error-icon"}),x]}),0===h.length?(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-icon",children:(0,r.jsx)("i",{className:"fas fa-comments"})}),(0,r.jsx)("h3",{className:"empty-title",children:"No chat sessions found"}),(0,r.jsx)("p",{className:"empty-description",children:C?"Try adjusting your search terms":"Chat sessions will appear here when users start conversations"})]}):(0,r.jsx)("div",{className:"sessions-grid",children:h.map(s=>{var e,a,t,i,n,l,o,c;return(0,r.jsx)("div",{className:"session-card",onClick:()=>M(s._id),children:(0,r.jsxs)("div",{className:"session-content",children:[(0,r.jsxs)("div",{className:"user-avatar-container",children:[(0,r.jsx)("img",{src:A(null===(e=s.userInfo)||void 0===e?void 0:e.photo,!(null!==(a=s.userInfo)&&void 0!==a&&a.userId)),alt:"User",className:"user-avatar"}),(0,r.jsx)("div",{className:"status-indicator ".concat(D(s.status))})]}),(0,r.jsxs)("div",{className:"session-details",children:[(0,r.jsxs)("div",{className:"session-header",children:[(0,r.jsxs)("div",{className:"user-info",children:[(0,r.jsxs)("h3",{children:[(null===(t=s.userInfo)||void 0===t?void 0:t.firstName)||"Guest User"," ",(null===(i=s.userInfo)||void 0===i?void 0:i.lastName)||""]}),(0,r.jsx)("p",{children:(null===(n=s.userInfo)||void 0===n?void 0:n.email)||"No email provided"})]}),(0,r.jsxs)("div",{className:"session-meta",children:[s.unreadCount>0&&(0,r.jsx)("span",{className:"unread-count",children:s.unreadCount}),(0,r.jsx)("span",{className:"status-badge ".concat(L(s.status)),children:s.status}),(0,r.jsx)("span",{className:"timestamp",children:y((null===(l=s.lastMessage)||void 0===l?void 0:l.timestamp)||s.createdAt)})]})]}),(0,r.jsx)("div",{className:"last-message",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"user"===(null===(o=s.lastMessage)||void 0===o?void 0:o.senderType)?"User: ":"Agent: "}),(null===(c=s.lastMessage)||void 0===c?void 0:c.message)||"No messages yet"]})}),(0,r.jsxs)("div",{className:"session-footer",children:[(0,r.jsxs)("div",{className:"session-info",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("i",{className:"fas fa-calendar-alt"}),new Date(s.createdAt).toLocaleDateString()]}),s.agent&&(0,r.jsxs)("span",{children:[(0,r.jsx)("i",{className:"fas fa-user"}),s.agent.firstname," ",s.agent.lastname]})]}),(0,r.jsxs)("div",{className:"session-actions",children:["waiting"===s.status&&(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),I(s._id)},className:"action-button take-session-button",children:[(0,r.jsx)("i",{className:"fas fa-hand-paper"})," Take Session"]}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),M(s._id)},className:"action-button open-chat-button",children:[(0,r.jsx)("i",{className:"fas fa-comments"})," Open Chat"]})]})]})]})]})},s._id)})})]})]})}}}]);
//# sourceMappingURL=3119.f676c63c.chunk.js.map