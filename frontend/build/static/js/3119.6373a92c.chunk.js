"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3119],{3119:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});var s=t(2483),a=t(9859),i=t(5296),o=t(1458),r=t(6723);const l=()=>{const{socket:e,isConnected:n}=(0,i.Y)(),[t]=(0,a.A)(),l=null===t||void 0===t?void 0:t.user,[d,p]=(0,s.useState)([]),[c,x]=(0,s.useState)([]),[u,g]=(0,s.useState)(!0),[f,b]=(0,s.useState)(null),[h,m]=(0,s.useState)("all"),[v,y]=(0,s.useState)(""),[w,S]=(0,s.useState)({totalSessions:0,activeSessions:0,waitingSessions:0}),j=(0,s.useCallback)(function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!e)return"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300";return"string"===typeof e&&e.startsWith("/uploads/userAvatars/")?`http://localhost:8000${e}`:e},[]),k=(0,s.useCallback)(e=>{const n=Date.now()-new Date(e).getTime(),t=Math.floor(n/6e4),s=Math.floor(t/60),a=Math.floor(s/24);return a>0?`${a}d ago`:s>0?`${s}h ago`:t>0?`${t}m ago`:"Just now"},[]),C=(0,s.useCallback)(async()=>{g(!0),b(null);try{const e=await o.A.get("/api/v1/admin/chat/sessions");if(e.data.success){const{sessions:n,totalSessions:t,activeSessions:s,waitingSessions:a}=e.data.data;p(n||[]),S({totalSessions:t||0,activeSessions:s||0,waitingSessions:a||0})}else b("Failed to load chat sessions")}catch(s){var e,n,t;if(console.error("Error loading sessions:",s),404===(null===(e=s.response)||void 0===e?void 0:e.status))b("Chat feature not available. Please contact administrator.");else b((null===(n=s.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to load chat sessions")}finally{g(!1)}},[]);(0,s.useEffect)(()=>{!l||1!==l.role&&0!==l.role?window.location.href="/Admin/Dashboard":C()},[l,C]),(0,s.useEffect)(()=>{let e=d;if("all"!==h&&(e=e.filter(e=>e.status===h)),v.trim()){const n=v.toLowerCase();e=e.filter(e=>{var t,s,a,i,o,r,l,d;return(null===(t=e.userInfo)||void 0===t||null===(s=t.firstName)||void 0===s?void 0:s.toLowerCase().includes(n))||(null===(a=e.userInfo)||void 0===a||null===(i=a.lastName)||void 0===i?void 0:i.toLowerCase().includes(n))||(null===(o=e.userInfo)||void 0===o||null===(r=o.email)||void 0===r?void 0:r.toLowerCase().includes(n))||(null===(l=e.lastMessage)||void 0===l||null===(d=l.message)||void 0===d?void 0:d.toLowerCase().includes(n))})}x(e)},[d,h,v]),(0,s.useEffect)(()=>{if(!e)return;const n=e=>{p(n=>[e,...n]),S(e=>({...e,totalSessions:e.totalSessions+1,waitingSessions:e.waitingSessions+1}))},t=e=>{p(n=>n.map(n=>n._id===e._id?e:n))},s=e=>{p(n=>n.map(n=>n._id===e.sessionId?{...n,lastMessage:e,unreadCount:n.unreadCount+("user"===e.senderType?1:0)}:n))};return e.on("admin:new_session",n),e.on("admin:session_updated",t),e.on("message:new",s),()=>{e.off("admin:new_session",n),e.off("admin:session_updated",t),e.off("message:new",s)}},[e]);const I=(0,s.useCallback)(async e=>{try{(await o.A.post(`/api/v1/admin/chat/assign/${e}`,{adminId:l._id})).data.success&&(p(n=>n.map(n=>n._id===e?{...n,status:"active",agent:l}:n)),window.open(`/admin/chat/session/${e}`,"_blank"))}catch(f){console.error("Error assigning session:",f),b("Failed to assign session")}},[l]),T=(0,s.useCallback)(e=>{switch(e){case"active":return"#4caf50";case"waiting":return"#ff9800";case"ended":return"#9e9e9e";default:return"#6c757d"}},[]),z=[{value:"all",label:"All Sessions",count:w.totalSessions},{value:"waiting",label:"Waiting",count:w.waitingSessions},{value:"active",label:"Active",count:w.activeSessions},{value:"ended",label:"Ended",count:w.totalSessions-w.activeSessions-w.waitingSessions}];return u?(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,r.jsx)("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #007bff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"20px"}}),(0,r.jsx)("p",{style:{color:"#666",fontSize:"16px"},children:"Loading chat sessions..."})]}):(0,r.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,r.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",padding:"24px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"24px"},children:[(0,r.jsx)("h1",{style:{margin:0,fontSize:"28px",fontWeight:"700",color:"#2d3748",background:"linear-gradient(135deg, #667eea, #764ba2)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Live Chat Management"}),(0,r.jsx)("button",{onClick:C,style:{padding:"12px 20px",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"white",border:"none",borderRadius:"12px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.3s ease"},children:"\ud83d\udd04 Refresh"})]}),(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"24px"},children:[{label:"Total Sessions",value:w.totalSessions,color:"#667eea",icon:"\ud83d\udcac"},{label:"Active Chats",value:w.activeSessions,color:"#4caf50",icon:"\ud83d\udfe2"},{label:"Waiting for Agent",value:w.waitingSessions,color:"#ff9800",icon:"\u23f3"},{label:"Connection Status",value:n?"Online":"Offline",color:n?"#4caf50":"#f44336",icon:n?"\ud83d\udcf6":"\ud83d\udcf5"}].map((e,n)=>(0,r.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",padding:"20px",borderRadius:"16px",textAlign:"center",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)"},children:[(0,r.jsx)("div",{style:{fontSize:"24px",marginBottom:"8px"},children:e.icon}),(0,r.jsx)("div",{style:{fontSize:"24px",fontWeight:"700",color:e.color,marginBottom:"4px"},children:e.value}),(0,r.jsx)("div",{style:{fontSize:"14px",color:"#718096",fontWeight:"500"},children:e.label})]},n))}),(0,r.jsxs)("div",{style:{display:"flex",gap:"16px",alignItems:"center",flexWrap:"wrap"},children:[(0,r.jsx)("div",{style:{display:"flex",gap:"8px",background:"rgba(255, 255, 255, 0.7)",padding:"6px",borderRadius:"12px",backdropFilter:"blur(10px)"},children:z.map(e=>(0,r.jsxs)("button",{onClick:()=>m(e.value),style:{padding:"8px 16px",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease",background:h===e.value?"linear-gradient(135deg, #667eea, #764ba2)":"transparent",color:h===e.value?"white":"#4a5568"},children:[e.label," (",e.count,")"]},e.value))}),(0,r.jsx)("input",{type:"text",placeholder:"Search sessions...",value:v,onChange:e=>y(e.target.value),style:{flex:1,minWidth:"200px",padding:"12px 16px",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"12px",fontSize:"14px",background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",outline:"none",transition:"all 0.3s ease"},onFocus:e=>e.target.style.borderColor="#667eea",onBlur:e=>e.target.style.borderColor="rgba(255, 255, 255, 0.3)"})]})]}),(0,r.jsxs)("div",{style:{padding:"24px"},children:[f&&(0,r.jsxs)("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px",padding:"16px",marginBottom:"24px",color:"#dc2626",textAlign:"center"},children:["\u26a0\ufe0f ",f]}),0===c.length?(0,r.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(20px)",borderRadius:"16px",padding:"60px 24px",textAlign:"center",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.1)"},children:[(0,r.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\ud83d\udcac"}),(0,r.jsx)("h3",{style:{color:"#4a5568",marginBottom:"8px",fontSize:"20px"},children:"No chat sessions found"}),(0,r.jsx)("p",{style:{color:"#718096",margin:0,fontSize:"16px"},children:v?"Try adjusting your search terms":"Chat sessions will appear here when users start conversations"})]}):(0,r.jsx)("div",{style:{display:"grid",gap:"16px"},children:c.map(e=>{var n,t,s,a,i,o,l,d;return(0,r.jsx)("div",{style:{background:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(20px)",borderRadius:"16px",padding:"20px",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.3s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 12px 40px rgba(0, 0, 0, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 8px 30px rgba(0, 0, 0, 0.1)"},onClick:()=>window.open(`/admin/chat/session/${e._id}`,"_blank"),children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"16px"},children:[(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsx)("img",{src:j(null===(n=e.userInfo)||void 0===n?void 0:n.photo,!(null!==(t=e.userInfo)&&void 0!==t&&t.userId)),alt:"User",style:{width:"56px",height:"56px",borderRadius:"50%",objectFit:"cover",border:"3px solid rgba(255, 255, 255, 0.5)"}}),(0,r.jsx)("div",{style:{position:"absolute",bottom:"2px",right:"2px",width:"16px",height:"16px",borderRadius:"50%",background:T(e.status),border:"2px solid white"}})]}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"8px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#2d3748",marginBottom:"4px"},children:[(null===(s=e.userInfo)||void 0===s?void 0:s.firstName)||"Guest User"," ",(null===(a=e.userInfo)||void 0===a?void 0:a.lastName)||""]}),(0,r.jsx)("p",{style:{margin:0,fontSize:"14px",color:"#718096"},children:(null===(i=e.userInfo)||void 0===i?void 0:i.email)||"No email provided"})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.unreadCount>0&&(0,r.jsx)("span",{style:{background:"#ef4444",color:"white",fontSize:"12px",fontWeight:"600",padding:"4px 8px",borderRadius:"12px",minWidth:"20px",textAlign:"center"},children:e.unreadCount}),(0,r.jsx)("span",{style:{background:`${T(e.status)}20`,color:T(e.status),fontSize:"12px",fontWeight:"600",padding:"6px 12px",borderRadius:"20px",textTransform:"capitalize"},children:e.status}),(0,r.jsx)("span",{style:{fontSize:"12px",color:"#a0aec0",fontWeight:"500"},children:k((null===(o=e.lastMessage)||void 0===o?void 0:o.timestamp)||e.createdAt)})]})]}),(0,r.jsx)("div",{style:{marginBottom:"12px"},children:(0,r.jsxs)("p",{style:{margin:0,fontSize:"14px",color:"#4a5568",lineHeight:"1.5",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[(0,r.jsx)("strong",{children:"user"===(null===(l=e.lastMessage)||void 0===l?void 0:l.senderType)?"User: ":"Agent: "}),(null===(d=e.lastMessage)||void 0===d?void 0:d.message)||"No messages yet"]})}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",fontSize:"12px",color:"#718096"},children:[(0,r.jsxs)("span",{children:["\ud83d\udcc5 ",new Date(e.createdAt).toLocaleDateString()]}),e.agent&&(0,r.jsxs)("span",{children:["\ud83d\udc64 ",e.agent.firstname," ",e.agent.lastname]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px"},children:["waiting"===e.status&&(0,r.jsx)("button",{onClick:n=>{n.stopPropagation(),I(e._id)},style:{padding:"8px 16px",background:"linear-gradient(135deg, #10b981, #059669)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"12px",fontWeight:"600",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(16, 185, 129, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"\u270b Take Session"}),(0,r.jsx)("button",{onClick:n=>{n.stopPropagation(),window.open(`/admin/chat/session/${e._id}`,"_blank")},style:{padding:"8px 16px",background:"linear-gradient(135deg, #667eea, #764ba2)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"12px",fontWeight:"600",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"\ud83d\udcac Open Chat"})]})]})]})]})},e._id)})})]}),(0,r.jsx)("style",{jsx:!0,children:"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n        \n        @keyframes fadeIn {\n          from {\n            opacity: 0;\n            transform: translateY(20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        \n        /* Responsive Design */\n        @media (max-width: 768px) {\n          .stats-grid {\n            grid-template-columns: repeat(2, 1fr) !important;\n          }\n          \n          .filters-container {\n            flex-direction: column !important;\n            align-items: stretch !important;\n          }\n          \n          .session-card {\n            padding: 16px !important;\n          }\n          \n          .session-header {\n            flex-direction: column !important;\n            align-items: flex-start !important;\n            gap: 8px !important;\n          }\n          \n          .session-actions {\n            justify-content: flex-start !important;\n            flex-wrap: wrap !important;\n          }\n        }\n        \n        @media (max-width: 480px) {\n          .stats-grid {\n            grid-template-columns: 1fr !important;\n          }\n          \n          .user-avatar {\n            width: 48px !important;\n            height: 48px !important;\n          }\n          \n          .session-meta {\n            flex-direction: column !important;\n            align-items: flex-start !important;\n            gap: 4px !important;\n          }\n        }\n        \n        /* Scrollbar styling */\n        ::-webkit-scrollbar {\n          width: 8px;\n        }\n        \n        ::-webkit-scrollbar-track {\n          background: rgba(255, 255, 255, 0.1);\n          border-radius: 4px;\n        }\n        \n        ::-webkit-scrollbar-thumb {\n          background: rgba(255, 255, 255, 0.3);\n          border-radius: 4px;\n        }\n        \n        ::-webkit-scrollbar-thumb:hover {\n          background: rgba(255, 255, 255, 0.5);\n        }\n        \n        /* Focus indicators for accessibility */\n        button:focus {\n          outline: 2px solid #667eea;\n          outline-offset: 2px;\n        }\n        \n        input:focus {\n          outline: none;\n          box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);\n        }\n      "})]})}}}]);
//# sourceMappingURL=3119.6373a92c.chunk.js.map