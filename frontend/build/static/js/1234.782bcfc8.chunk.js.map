{"version":3,"file":"static/js/1234.782bcfc8.chunk.js","mappings":"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","sources":["Pages/Admin/AdminLiveChat/AdminLiveChat.jsx"],"sourcesContent":["//frontend/src/Pages/Admin/AdminLiveChat/AdminLiveChat.jsx\r\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from \"../../../Context/AuthContext\";\r\nimport { useSocket } from \"../../../Context/SocketContext\";\r\nimport API from \"../../../helpers/API\";\r\nimport './AdminLiveChat.css';\r\n\r\nconst AdminLiveChat = () => {\r\n  const { sessionId } = useParams();\r\n  const navigate = useNavigate();\r\n  const { socket, isConnected } = useSocket();\r\n  const [auth] = useAuth();\r\n  const adminUser = auth?.user;\r\n  const messagesEndRef = useRef(null);\r\n\r\n  // State\r\n  const [session, setSession] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSending, setIsSending] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [userInfo, setUserInfo] = useState(null);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const [connectionStatus, setConnectionStatus] = useState('connecting');\r\n\r\n  // Scroll to bottom of messages\r\n  const scrollToBottom = useCallback(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, []);\r\n\r\n  // Load session data and messages\r\n  const loadSessionData = useCallback(async () => {\r\n    if (!sessionId) return;\r\n    \r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await API.get(`/api/v1/admin/chat/session/${sessionId}`);\r\n      \r\n      if (response.data.success) {\r\n        const { session, messages, userInfo } = response.data.data;\r\n        setSession(session);\r\n        setMessages(messages || []);\r\n        setUserInfo(userInfo || session.userInfo);\r\n        setConnectionStatus('connected');\r\n      } else {\r\n        setError('Failed to load chat session');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading session:', err);\r\n      if (err.response?.status === 404) {\r\n        setError('Chat session not found');\r\n      } else if (err.response?.status === 403) {\r\n        setError('Access denied to this chat session');\r\n      } else {\r\n        setError(err.response?.data?.message || 'Failed to load chat session');\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [sessionId]);\r\n\r\n  // Admin permission check and session load\r\n  useEffect(() => {\r\n    if (!adminUser || (adminUser.role !== 1 && adminUser.role !== 0)) {\r\n      navigate('/Admin/Dashboard');\r\n      return;\r\n    }\r\n\r\n    if (!sessionId) {\r\n      setError('No session ID provided');\r\n      return;\r\n    }\r\n\r\n    loadSessionData();\r\n  }, [adminUser, sessionId, loadSessionData, navigate]);\r\n\r\n  // Auto-assign session on load if not already assigned\r\n  useEffect(() => {\r\n    const autoAssignSession = async () => {\r\n      if (session && session.status === 'waiting' && (!session.agentId || session.agentId !== adminUser._id)) {\r\n        try {\r\n          await API.post(`/api/v1/admin/chat/assign/${sessionId}`, {\r\n            adminId: adminUser._id\r\n          });\r\n          \r\n          // Reload session data to get updated info\r\n          loadSessionData();\r\n        } catch (error) {\r\n          console.error('Error auto-assigning session:', error);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (session && adminUser) {\r\n      autoAssignSession();\r\n    }\r\n  }, [session, adminUser, sessionId, loadSessionData]);\r\n\r\n  // Socket event handlers\r\n  useEffect(() => {\r\n    if (!socket || !sessionId) return;\r\n\r\n    // Join the session room\r\n    socket.emit('admin:join_session', { sessionId, adminId: adminUser._id });\r\n\r\n    const handleNewMessage = (message) => {\r\n      if (message.sessionId === sessionId) {\r\n        setMessages(prev => [...prev, message]);\r\n        scrollToBottom();\r\n      }\r\n    };\r\n\r\n    const handleSessionUpdate = (updatedSession) => {\r\n      if (updatedSession._id === sessionId) {\r\n        setSession(updatedSession);\r\n      }\r\n    };\r\n\r\n    const handleUserTyping = (data) => {\r\n      if (data.sessionId === sessionId) {\r\n        setIsTyping(data.isTyping);\r\n      }\r\n    };\r\n\r\n    socket.on('message:new', handleNewMessage);\r\n    socket.on('session:updated', handleSessionUpdate);\r\n    socket.on('user:typing', handleUserTyping);\r\n\r\n    return () => {\r\n      socket.off('message:new', handleNewMessage);\r\n      socket.off('session:updated', handleSessionUpdate);\r\n      socket.off('user:typing', handleUserTyping);\r\n      \r\n      // Leave the session room\r\n      socket.emit('admin:leave_session', { sessionId, adminId: adminUser._id });\r\n    };\r\n  }, [socket, sessionId, adminUser, scrollToBottom]);\r\n\r\n  // Auto-scroll when messages change\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages, scrollToBottom]);\r\n\r\n  // Send message - FIXED VERSION\r\n  const sendMessage = useCallback(async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!newMessage.trim() || isSending) return;\r\n\r\n    const messageText = newMessage.trim();\r\n    setNewMessage('');\r\n    setIsSending(true);\r\n\r\n    try {\r\n      // Determine sender model based on admin user type\r\n      const senderModel = 'User'; // Since admin is a User in your schema\r\n      \r\n      const response = await API.post('/api/v1/admin/chat/message', {\r\n        sessionId,\r\n        message: messageText,\r\n        senderType: 'agent',\r\n        senderId: adminUser._id,\r\n        senderModel: senderModel // ADD THIS REQUIRED FIELD\r\n      });\r\n\r\n      if (response.data.success) {\r\n        // Message will be added via socket event\r\n        console.log('Message sent successfully');\r\n      } else {\r\n        throw new Error(response.data.message || 'Failed to send message');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending message:', error);\r\n      const errorMessage = error.response?.data?.message || error.message || 'Failed to send message';\r\n      setError(errorMessage);\r\n      // Restore message text\r\n      setNewMessage(messageText);\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  }, [newMessage, isSending, sessionId, adminUser]);\r\n\r\n  // End session\r\n  const endSession = useCallback(async () => {\r\n    if (!window.confirm('Are you sure you want to end this chat session?')) return;\r\n\r\n    try {\r\n      const response = await API.post(`/api/v1/admin/chat/end/${sessionId}`, {\r\n        reason: 'ended_by_agent'\r\n      });\r\n\r\n      if (response.data.success) {\r\n        setSession(prev => ({ ...prev, status: 'ended' }));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error ending session:', error);\r\n      setError('Failed to end session');\r\n    }\r\n  }, [sessionId]);\r\n\r\n  // Get profile image\r\n  const getProfileImageSrc = useCallback((userPhoto, isGuest = false) => {\r\n    if (isGuest || !userPhoto) {\r\n      return \"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300\";\r\n    }\r\n    const isUploadPath = typeof userPhoto === \"string\" && userPhoto.startsWith(\"/uploads/userAvatars/\");\r\n    return isUploadPath ? `${process.env.REACT_APP_API_URL}${userPhoto}` : userPhoto;\r\n  }, []);\r\n\r\n  // Format timestamp - FIXED VERSION\r\n  const formatMessageTime = useCallback((timestamp) => {\r\n    try {\r\n      const date = new Date(timestamp);\r\n      // Check if date is valid\r\n      if (isNaN(date.getTime())) {\r\n        console.warn('Invalid date:', timestamp);\r\n        return 'Invalid time';\r\n      }\r\n      return date.toLocaleTimeString('en-US', {\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    } catch (error) {\r\n      console.error('Error formatting time:', error);\r\n      return 'Invalid time';\r\n    }\r\n  }, []);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"loading-container\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p className=\"loading-text\">Loading chat session...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"error-container\">\r\n        <div className=\"error-content\">\r\n          <i className=\"fas fa-exclamation-triangle error-icon\"></i>\r\n          <h3>Error Loading Chat</h3>\r\n          <p>{error}</p>\r\n          <button \r\n            onClick={() => {\r\n              setError(null);\r\n              loadSessionData();\r\n            }}\r\n            className=\"btn btn-secondary mr-2\"\r\n          >\r\n            Retry\r\n          </button>\r\n          <button \r\n            onClick={() => navigate('/Admin/Chat-List')}\r\n            className=\"btn btn-primary\"\r\n          >\r\n            Back to Chat List\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"admin-live-chat-container\">\r\n      {/* Header */}\r\n      <div className=\"chat-header\">\r\n        <div className=\"chat-header-left\">\r\n          <button \r\n            onClick={() => navigate('/Admin/Chat-List')}\r\n            className=\"back-button\"\r\n          >\r\n            <i className=\"fas fa-arrow-left\"></i>\r\n          </button>\r\n          \r\n          <div className=\"user-avatar\">\r\n            <img\r\n              src={getProfileImageSrc(userInfo?.photo, !userInfo?.userId)}\r\n              alt=\"User\"\r\n              className=\"avatar-img\"\r\n            />\r\n            <div className={`status-indicator ${session?.status === 'active' ? 'online' : 'offline'}`} />\r\n          </div>\r\n          \r\n          <div className=\"user-details\">\r\n            <h3 className=\"user-name\">\r\n              {userInfo?.firstName || userInfo?.firstname || 'Guest User'} {userInfo?.lastName || userInfo?.lastname || ''}\r\n            </h3>\r\n            <p className=\"user-status\">\r\n              {userInfo?.email || 'No email provided'}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"chat-header-right\">\r\n          <div className=\"connection-status\">\r\n            <i className={`fas ${isConnected ? 'fa-wifi' : 'fa-wifi-slash'}`}></i>\r\n            <span>{isConnected ? 'Connected' : 'Disconnected'}</span>\r\n          </div>\r\n          \r\n          <div className=\"session-info\">\r\n            <span className={`status-badge status-${session?.status}`}>\r\n              {session?.status}\r\n            </span>\r\n            <span className=\"session-id\">#{sessionId.slice(-6)}</span>\r\n          </div>\r\n          \r\n          {session?.status !== 'ended' && (\r\n            <button \r\n              onClick={endSession}\r\n              className=\"end-session-button\"\r\n            >\r\n              <i className=\"fas fa-times\"></i>\r\n              End Chat\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages Area */}\r\n      <div className=\"chat-messages\">\r\n        <div className=\"messages-list\">\r\n          {messages.map((message) => (\r\n            <div\r\n              key={message._id}\r\n              className={`message ${message.senderType === 'agent' ? 'message-sent' : 'message-received'}`}\r\n            >\r\n              <div className=\"message-content\">\r\n                <div className=\"message-text\">\r\n                  {message.message}\r\n                </div>\r\n                <div className=\"message-time\">\r\n                  {formatMessageTime(message.createdAt || message.timestamp)}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          \r\n          {isTyping && (\r\n            <div className=\"message message-received typing-indicator\">\r\n              <div className=\"message-content\">\r\n                <div className=\"typing-dots\">\r\n                  <span></span>\r\n                  <span></span>\r\n                  <span></span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Message Input */}\r\n      <div className=\"chat-input-container\">\r\n        {session?.status === 'ended' ? (\r\n          <div className=\"session-ended-notice\">\r\n            <i className=\"fas fa-info-circle\"></i>\r\n            This chat session has ended\r\n          </div>\r\n        ) : (\r\n          <form onSubmit={sendMessage} className=\"chat-input-form\">\r\n            <div className=\"input-group\">\r\n              <input\r\n                type=\"text\"\r\n                value={newMessage}\r\n                onChange={(e) => setNewMessage(e.target.value)}\r\n                placeholder=\"Type your message...\"\r\n                className=\"message-input\"\r\n                disabled={isSending || !isConnected}\r\n              />\r\n              <button\r\n                type=\"submit\"\r\n                disabled={!newMessage.trim() || isSending || !isConnected}\r\n                className=\"send-button\"\r\n              >\r\n                {isSending ? (\r\n                  <i className=\"fas fa-spinner fa-spin\"></i>\r\n                ) : (\r\n                  <i className=\"fas fa-paper-plane\"></i>\r\n                )}\r\n              </button>\r\n            </div>\r\n            \r\n            <div className=\"input-status\">\r\n              {!isConnected && (\r\n                <span className=\"connection-warning\">\r\n                  <i className=\"fas fa-exclamation-triangle\"></i>\r\n                  Connection lost - messages may not be delivered\r\n                </span>\r\n              )}\r\n              {error && (\r\n                <span className=\"error-warning\">\r\n                  <i className=\"fas fa-exclamation-circle\"></i>\r\n                  {error}\r\n                  <button \r\n                    onClick={() => setError(null)} \r\n                    className=\"error-dismiss\"\r\n                    type=\"button\"\r\n                  >\r\n                    Ã—\r\n                  </button>\r\n                </span>\r\n              )}\r\n            </div>\r\n          </form>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminLiveChat;\r\n"],"names":["AdminLiveChat","sessionId","useParams","navigate","useNavigate","socket","isConnected","useSocket","auth","useAuth","adminUser","user","messagesEndRef","useRef","session","setSession","useState","messages","setMessages","newMessage","setNewMessage","isLoading","setIsLoading","isSending","setIsSending","error","setError","userInfo","setUserInfo","isTyping","setIsTyping","connectionStatus","setConnectionStatus","scrollToBottom","useCallback","_messagesEndRef$curre","current","scrollIntoView","behavior","loadSessionData","async","response","API","get","data","success","err","_err$response","_err$response2","console","status","_err$response3","_err$response3$data","message","useEffect","role","agentId","_id","post","adminId","autoAssignSession","emit","handleNewMessage","prev","handleSessionUpdate","updatedSession","handleUserTyping","on","off","sendMessage","e","preventDefault","trim","messageText","senderModel","senderType","senderId","Error","log","_error$response","_error$response$data","errorMessage","endSession","window","confirm","reason","getProfileImageSrc","userPhoto","arguments","length","undefined","startsWith","formatMessageTime","timestamp","date","Date","isNaN","getTime","warn","toLocaleTimeString","hour","minute","_jsxs","className","children","_jsx","onClick","src","photo","userId","alt","firstName","firstname","lastName","lastname","email","slice","map","createdAt","ref","onSubmit","type","value","onChange","target","placeholder","disabled"],"sourceRoot":""}