{"version":3,"file":"static/js/1234.180e9740.chunk.js","mappings":"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","sources":["Pages/Admin/AdminLiveChat/AdminLiveChat.jsx"],"sourcesContent":["//frontend/src/Pages/Admin/AdminLiveChat/AdminLiveChat.jsx\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from \"../../../Context/AuthContext\";\nimport { useSocket } from \"../../../Context/SocketContext\";\nimport API from \"../../../helpers/API\";\nimport './AdminLiveChat.css';\n\nconst AdminLiveChat = () => {\n  const { sessionId } = useParams();\n  const navigate = useNavigate();\n  const { socket, isConnected } = useSocket();\n  const [auth] = useAuth();\n  const adminUser = auth?.user;\n  const messagesEndRef = useRef(null);\n\n  // State\n  const [session, setSession] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSending, setIsSending] = useState(false);\n  const [error, setError] = useState(null);\n  const [userInfo, setUserInfo] = useState(null);\n  const [isTyping, setIsTyping] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState('connecting');\n\n  // Scroll to bottom of messages\n  const scrollToBottom = useCallback(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, []);\n\n  // Load session data and messages\n  const loadSessionData = useCallback(async () => {\n    if (!sessionId) return;\n    \n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const response = await API.get(`/api/v1/admin/chat/session/${sessionId}`);\n      \n      if (response.data.success) {\n        const { session, messages, userInfo } = response.data.data;\n        setSession(session);\n        setMessages(messages || []);\n        setUserInfo(userInfo || session.userInfo);\n        setConnectionStatus('connected');\n      } else {\n        setError('Failed to load chat session');\n      }\n    } catch (err) {\n      console.error('Error loading session:', err);\n      if (err.response?.status === 404) {\n        setError('Chat session not found');\n      } else if (err.response?.status === 403) {\n        setError('Access denied to this chat session');\n      } else {\n        setError(err.response?.data?.message || 'Failed to load chat session');\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  }, [sessionId]);\n\n  // Admin permission check and session load\n  useEffect(() => {\n    if (!adminUser || (adminUser.role !== 1 && adminUser.role !== 0)) {\n      navigate('/Admin/Dashboard');\n      return;\n    }\n\n    if (!sessionId) {\n      setError('No session ID provided');\n      return;\n    }\n\n    loadSessionData();\n  }, [adminUser, sessionId, loadSessionData, navigate]);\n\n  // Auto-assign session on load if not already assigned\n  useEffect(() => {\n    const autoAssignSession = async () => {\n      if (session && session.status === 'waiting' && (!session.agentId || session.agentId !== adminUser._id)) {\n        try {\n          await API.post(`/api/v1/admin/chat/assign/${sessionId}`, {\n            adminId: adminUser._id\n          });\n          \n          // Reload session data to get updated info\n          loadSessionData();\n        } catch (error) {\n          console.error('Error auto-assigning session:', error);\n        }\n      }\n    };\n\n    if (session && adminUser) {\n      autoAssignSession();\n    }\n  }, [session, adminUser, sessionId, loadSessionData]);\n\n  // Socket event handlers\n  useEffect(() => {\n    if (!socket || !sessionId) return;\n\n    // Join the session room\n    socket.emit('admin:join_session', { sessionId, adminId: adminUser._id });\n\n    const handleNewMessage = (message) => {\n      if (message.sessionId === sessionId) {\n        setMessages(prev => [...prev, message]);\n        scrollToBottom();\n      }\n    };\n\n    const handleSessionUpdate = (updatedSession) => {\n      if (updatedSession._id === sessionId) {\n        setSession(updatedSession);\n      }\n    };\n\n    const handleUserTyping = (data) => {\n      if (data.sessionId === sessionId) {\n        setIsTyping(data.isTyping);\n      }\n    };\n\n    socket.on('message:new', handleNewMessage);\n    socket.on('session:updated', handleSessionUpdate);\n    socket.on('user:typing', handleUserTyping);\n\n    return () => {\n      socket.off('message:new', handleNewMessage);\n      socket.off('session:updated', handleSessionUpdate);\n      socket.off('user:typing', handleUserTyping);\n      \n      // Leave the session room\n      socket.emit('admin:leave_session', { sessionId, adminId: adminUser._id });\n    };\n  }, [socket, sessionId, adminUser, scrollToBottom]);\n\n  // Auto-scroll when messages change\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, scrollToBottom]);\n\n  // Send message - FIXED VERSION\n  const sendMessage = useCallback(async (e) => {\n    e.preventDefault();\n    \n    if (!newMessage.trim() || isSending) return;\n\n    const messageText = newMessage.trim();\n    setNewMessage('');\n    setIsSending(true);\n\n    try {\n      // Determine sender model based on admin user type\n      const senderModel = 'User'; // Since admin is a User in your schema\n      \n      const response = await API.post('/api/v1/admin/chat/message', {\n        sessionId,\n        message: messageText,\n        senderType: 'agent',\n        senderId: adminUser._id,\n        senderModel: senderModel // ADD THIS REQUIRED FIELD\n      });\n\n      if (response.data.success) {\n        // Message will be added via socket event\n        console.log('Message sent successfully');\n      } else {\n        throw new Error(response.data.message || 'Failed to send message');\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n      const errorMessage = error.response?.data?.message || error.message || 'Failed to send message';\n      setError(errorMessage);\n      // Restore message text\n      setNewMessage(messageText);\n    } finally {\n      setIsSending(false);\n    }\n  }, [newMessage, isSending, sessionId, adminUser]);\n\n  // End session\n  const endSession = useCallback(async () => {\n    if (!window.confirm('Are you sure you want to end this chat session?')) return;\n\n    try {\n      const response = await API.post(`/api/v1/admin/chat/end/${sessionId}`, {\n        reason: 'ended_by_agent'\n      });\n\n      if (response.data.success) {\n        setSession(prev => ({ ...prev, status: 'ended' }));\n      }\n    } catch (error) {\n      console.error('Error ending session:', error);\n      setError('Failed to end session');\n    }\n  }, [sessionId]);\n\n  // Get profile image\n  const getProfileImageSrc = useCallback((userPhoto, isGuest = false) => {\n    if (isGuest || !userPhoto) {\n      return \"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300\";\n    }\n    const isUploadPath = typeof userPhoto === \"string\" && userPhoto.startsWith(\"/uploads/userAvatars/\");\n    return isUploadPath ? `${process.env.REACT_APP_API_URL}${userPhoto}` : userPhoto;\n  }, []);\n\n  // Format timestamp - FIXED VERSION\n  const formatMessageTime = useCallback((timestamp) => {\n    try {\n      const date = new Date(timestamp);\n      // Check if date is valid\n      if (isNaN(date.getTime())) {\n        console.warn('Invalid date:', timestamp);\n        return 'Invalid time';\n      }\n      return date.toLocaleTimeString('en-US', {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } catch (error) {\n      console.error('Error formatting time:', error);\n      return 'Invalid time';\n    }\n  }, []);\n\n  if (isLoading) {\n    return (\n      <div className=\"loading-container\">\n        <div className=\"loading-spinner\"></div>\n        <p className=\"loading-text\">Loading chat session...</p>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"error-container\">\n        <div className=\"error-content\">\n          <i className=\"fas fa-exclamation-triangle error-icon\"></i>\n          <h3>Error Loading Chat</h3>\n          <p>{error}</p>\n          <button \n            onClick={() => {\n              setError(null);\n              loadSessionData();\n            }}\n            className=\"btn btn-secondary mr-2\"\n          >\n            Retry\n          </button>\n          <button \n            onClick={() => navigate('/Admin/Chat-List')}\n            className=\"btn btn-primary\"\n          >\n            Back to Chat List\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"admin-live-chat-container\">\n      {/* Header */}\n      <div className=\"chat-header\">\n        <div className=\"chat-header-left\">\n          <button \n            onClick={() => navigate('/Admin/Chat-List')}\n            className=\"back-button\"\n          >\n            <i className=\"fas fa-arrow-left\"></i>\n          </button>\n          \n          <div className=\"user-avatar\">\n            <img\n              src={getProfileImageSrc(userInfo?.photo, !userInfo?.userId)}\n              alt=\"User\"\n              className=\"avatar-img\"\n            />\n            <div className={`status-indicator ${session?.status === 'active' ? 'online' : 'offline'}`} />\n          </div>\n          \n          <div className=\"user-details\">\n            <h3 className=\"user-name\">\n              {userInfo?.firstName || userInfo?.firstname || 'Guest User'} {userInfo?.lastName || userInfo?.lastname || ''}\n            </h3>\n            <p className=\"user-status\">\n              {userInfo?.email || 'No email provided'}\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"chat-header-right\">\n          <div className=\"connection-status\">\n            <i className={`fas ${isConnected ? 'fa-wifi' : 'fa-wifi-slash'}`}></i>\n            <span>{isConnected ? 'Connected' : 'Disconnected'}</span>\n          </div>\n          \n          <div className=\"session-info\">\n            <span className={`status-badge status-${session?.status}`}>\n              {session?.status}\n            </span>\n            <span className=\"session-id\">#{sessionId.slice(-6)}</span>\n          </div>\n          \n          {session?.status !== 'ended' && (\n            <button \n              onClick={endSession}\n              className=\"end-session-button\"\n            >\n              <i className=\"fas fa-times\"></i>\n              End Chat\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Messages Area */}\n      <div className=\"chat-messages\">\n        <div className=\"messages-list\">\n          {messages.map((message) => (\n            <div\n              key={message._id}\n              className={`message ${message.senderType === 'agent' ? 'message-sent' : 'message-received'}`}\n            >\n              <div className=\"message-content\">\n                <div className=\"message-text\">\n                  {message.message}\n                </div>\n                <div className=\"message-time\">\n                  {formatMessageTime(message.createdAt || message.timestamp)}\n                </div>\n              </div>\n            </div>\n          ))}\n          \n          {isTyping && (\n            <div className=\"message message-received typing-indicator\">\n              <div className=\"message-content\">\n                <div className=\"typing-dots\">\n                  <span></span>\n                  <span></span>\n                  <span></span>\n                </div>\n              </div>\n            </div>\n          )}\n          \n          <div ref={messagesEndRef} />\n        </div>\n      </div>\n\n      {/* Message Input */}\n      <div className=\"chat-input-container\">\n        {session?.status === 'ended' ? (\n          <div className=\"session-ended-notice\">\n            <i className=\"fas fa-info-circle\"></i>\n            This chat session has ended\n          </div>\n        ) : (\n          <form onSubmit={sendMessage} className=\"chat-input-form\">\n            <div className=\"input-group\">\n              <input\n                type=\"text\"\n                value={newMessage}\n                onChange={(e) => setNewMessage(e.target.value)}\n                placeholder=\"Type your message...\"\n                className=\"message-input\"\n                disabled={isSending || !isConnected}\n              />\n              <button\n                type=\"submit\"\n                disabled={!newMessage.trim() || isSending || !isConnected}\n                className=\"send-button\"\n              >\n                {isSending ? (\n                  <i className=\"fas fa-spinner fa-spin\"></i>\n                ) : (\n                  <i className=\"fas fa-paper-plane\"></i>\n                )}\n              </button>\n            </div>\n            \n            <div className=\"input-status\">\n              {!isConnected && (\n                <span className=\"connection-warning\">\n                  <i className=\"fas fa-exclamation-triangle\"></i>\n                  Connection lost - messages may not be delivered\n                </span>\n              )}\n              {error && (\n                <span className=\"error-warning\">\n                  <i className=\"fas fa-exclamation-circle\"></i>\n                  {error}\n                  <button \n                    onClick={() => setError(null)} \n                    className=\"error-dismiss\"\n                    type=\"button\"\n                  >\n                    Ã—\n                  </button>\n                </span>\n              )}\n            </div>\n          </form>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AdminLiveChat;\n"],"names":["AdminLiveChat","sessionId","useParams","navigate","useNavigate","socket","isConnected","useSocket","auth","useAuth","adminUser","user","messagesEndRef","useRef","session","setSession","useState","messages","setMessages","newMessage","setNewMessage","isLoading","setIsLoading","isSending","setIsSending","error","setError","userInfo","setUserInfo","isTyping","setIsTyping","connectionStatus","setConnectionStatus","scrollToBottom","useCallback","_messagesEndRef$curre","current","scrollIntoView","behavior","loadSessionData","async","response","API","get","concat","data","success","err","_err$response","_err$response2","console","status","_err$response3","_err$response3$data","message","useEffect","role","agentId","_id","post","adminId","autoAssignSession","emit","handleNewMessage","prev","handleSessionUpdate","updatedSession","handleUserTyping","on","off","sendMessage","e","preventDefault","trim","messageText","senderModel","senderType","senderId","Error","log","_error$response","_error$response$data","errorMessage","endSession","window","confirm","reason","_objectSpread","getProfileImageSrc","userPhoto","arguments","length","undefined","startsWith","process","formatMessageTime","timestamp","date","Date","isNaN","getTime","warn","toLocaleTimeString","hour","minute","_jsxs","className","children","_jsx","onClick","src","photo","userId","alt","firstName","firstname","lastName","lastname","email","slice","map","createdAt","ref","onSubmit","type","value","onChange","target","placeholder","disabled"],"sourceRoot":""}