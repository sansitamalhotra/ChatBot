{"version":3,"file":"static/js/3119.4c2ab9a6.chunk.js","mappings":"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","sources":["Pages/Admin/AdminChatList/AdminChatList.jsx"],"sourcesContent":["//frontend/src/Pages/Admin/AdminChatList/AdminChatList.jsx\r\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { useNavigate } from 'react-router-dom'; // Add this import\r\nimport { useAuth } from \"../../../Context/AuthContext\"; // Fixed path\r\nimport { useSocket } from \"../../../Context/SocketContext\"; // Fixed path\r\nimport API from \"../../../helpers/API\"; // Fixed path\r\nimport './AdminLiveChat.css';\r\n\r\nconst AdminChatList = () => {\r\n  const navigate = useNavigate(); // Add navigation hook\r\n  const { socket, isConnected } = useSocket();\r\n  const [auth] = useAuth();\r\n  const adminUser = auth?.user;\r\n\r\n  // State\r\n  const [sessions, setSessions] = useState([]);\r\n  const [filteredSessions, setFilteredSessions] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [filter, setFilter] = useState('all');\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [stats, setStats] = useState({\r\n    totalSessions: 0,\r\n    activeSessions: 0,\r\n    waitingSessions: 0\r\n  });\r\n\r\n  // Helper function to get profile image\r\n  const getProfileImageSrc = useCallback((userPhoto, isGuest = false) => {\r\n    if (isGuest || !userPhoto) {\r\n      return \"https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg?w=300\";\r\n    }\r\n    const isUploadPath = typeof userPhoto === \"string\" && userPhoto.startsWith(\"/uploads/userAvatars/\");\r\n    return isUploadPath ? `${process.env.REACT_APP_API_URL}${userPhoto}` : userPhoto;\r\n  }, []);\r\n\r\n  // Format time\r\n  const formatTime = useCallback((timestamp) => {\r\n    const now = Date.now();\r\n    const diff = now - new Date(timestamp).getTime();\r\n    const minutes = Math.floor(diff / 60000);\r\n    const hours = Math.floor(minutes / 60);\r\n    const days = Math.floor(hours / 24);\r\n\r\n    if (days > 0) return `${days}d ago`;\r\n    if (hours > 0) return `${hours}h ago`;\r\n    if (minutes > 0) return `${minutes}m ago`;\r\n    return 'Just now';\r\n  }, []);\r\n\r\n  // Load chat sessions\r\n  const loadSessions = useCallback(async () => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await API.get('/api/v1/admin/chat/sessions');\r\n      \r\n      if (response.data.success) {\r\n        const { sessions: sessionData, totalSessions, activeSessions, waitingSessions } = response.data.data;\r\n        setSessions(sessionData || []);\r\n        setStats({\r\n          totalSessions: totalSessions || 0,\r\n          activeSessions: activeSessions || 0,\r\n          waitingSessions: waitingSessions || 0\r\n        });\r\n      } else {\r\n        setError('Failed to load chat sessions');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading sessions:', err);\r\n      if (err.response?.status === 404) {\r\n        setError('Chat feature not available. Please contact administrator.');\r\n      } else if (err.response?.status === 401) {\r\n        setError('Authentication failed. Please login again.');\r\n        // Redirect to admin dashboard\r\n        navigate('/Admin/Dashboard');\r\n      } else {\r\n        setError(err.response?.data?.message || 'Failed to load chat sessions');\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [navigate]);\r\n\r\n  // Admin permission check and initial load\r\n  useEffect(() => {\r\n    if (!adminUser || (adminUser.role !== 1 && adminUser.role !== 0)) {\r\n      navigate('/Admin/Dashboard');\r\n      return;\r\n    }\r\n    loadSessions();\r\n  }, [adminUser, loadSessions, navigate]);\r\n\r\n  // Filter and search sessions\r\n  useEffect(() => {\r\n    let filtered = sessions;\r\n\r\n    if (filter !== 'all') {\r\n      filtered = filtered.filter(session => session.status === filter);\r\n    }\r\n\r\n    if (searchQuery.trim()) {\r\n      const query = searchQuery.toLowerCase();\r\n      filtered = filtered.filter(session => \r\n        session.userInfo?.firstName?.toLowerCase().includes(query) ||\r\n        session.userInfo?.lastName?.toLowerCase().includes(query) ||\r\n        session.userInfo?.email?.toLowerCase().includes(query) ||\r\n        session.lastMessage?.message?.toLowerCase().includes(query)\r\n      );\r\n    }\r\n\r\n    setFilteredSessions(filtered);\r\n  }, [sessions, filter, searchQuery]);\r\n\r\n  // Socket event handlers\r\n  useEffect(() => {\r\n    if (!socket) return;\r\n\r\n    const handleNewSession = (sessionData) => {\r\n      setSessions(prev => [sessionData, ...prev]);\r\n      setStats(prev => ({\r\n        ...prev,\r\n        totalSessions: prev.totalSessions + 1,\r\n        waitingSessions: prev.waitingSessions + 1\r\n      }));\r\n    };\r\n\r\n    const handleSessionUpdate = (updatedSession) => {\r\n      setSessions(prev => \r\n        prev.map(session => \r\n          session._id === updatedSession._id ? updatedSession : session\r\n        )\r\n      );\r\n    };\r\n\r\n    const handleNewMessage = (message) => {\r\n      setSessions(prev => \r\n        prev.map(session => {\r\n          if (session._id === message.sessionId) {\r\n            return {\r\n              ...session,\r\n              lastMessage: message,\r\n              unreadCount: session.unreadCount + (message.senderType === 'user' ? 1 : 0)\r\n            };\r\n          }\r\n          return session;\r\n        })\r\n      );\r\n    };\r\n\r\n    socket.on('admin:new_session', handleNewSession);\r\n    socket.on('admin:session_updated', handleSessionUpdate);\r\n    socket.on('message:new', handleNewMessage);\r\n\r\n    return () => {\r\n      socket.off('admin:new_session', handleNewSession);\r\n      socket.off('admin:session_updated', handleSessionUpdate);\r\n      socket.off('message:new', handleNewMessage);\r\n    };\r\n  }, [socket]);\r\n\r\n  // Handle session assignment\r\n  const assignSession = useCallback(async (sessionId) => {\r\n    try {\r\n      const response = await API.post(`/api/v1/admin/chat/assign/${sessionId}`, {\r\n        adminId: adminUser._id\r\n      });\r\n\r\n      if (response.data.success) {\r\n        setSessions(prev => \r\n          prev.map(session => \r\n            session._id === sessionId \r\n              ? { ...session, status: 'active', agent: adminUser }\r\n              : session\r\n          )\r\n        );\r\n        // Use navigate instead of window.open for better routing\r\n        navigate(`/admin/chat/session/${sessionId}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error assigning session:', error);\r\n      setError('Failed to assign session');\r\n    }\r\n  }, [adminUser, navigate]);\r\n\r\n  // Handle navigation to chat session\r\n  const navigateToChat = useCallback((sessionId) => {\r\n    navigate(`/admin/chat/session/${sessionId}`);\r\n  }, [navigate]);\r\n\r\n  // Get status badge class\r\n  const getStatusClass = useCallback((status) => {\r\n    switch (status) {\r\n      case 'active':\r\n        return 'status-active';\r\n      case 'waiting':\r\n        return 'status-waiting';\r\n      case 'ended':\r\n        return 'status-ended';\r\n      default:\r\n        return 'status-default';\r\n    }\r\n  }, []);\r\n\r\n  // Get status indicator class\r\n  const getIndicatorClass = useCallback((status) => {\r\n    switch (status) {\r\n      case 'active':\r\n        return 'indicator-active';\r\n      case 'waiting':\r\n        return 'indicator-waiting';\r\n      case 'ended':\r\n        return 'indicator-ended';\r\n      default:\r\n        return 'indicator-default';\r\n    }\r\n  }, []);\r\n\r\n  // Filter options\r\n  const filterOptions = [\r\n    { value: 'all', label: 'All Sessions', count: stats.totalSessions },\r\n    { value: 'waiting', label: 'Waiting', count: stats.waitingSessions },\r\n    { value: 'active', label: 'Active', count: stats.activeSessions },\r\n    { value: 'ended', label: 'Ended', count: stats.totalSessions - stats.activeSessions - stats.waitingSessions }\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"loading-container\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p className=\"loading-text\">Loading chat sessions...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"admin-chat-list-container\">\r\n      {/* Header */}\r\n      <div className=\"header-container\">\r\n        <div className=\"header-top\">\r\n          <h1 className=\"header-title\">\r\n            Live Chat Management\r\n          </h1>\r\n          \r\n          <button onClick={loadSessions} className=\"refresh-button\">\r\n            <i className=\"fas fa-sync-alt\"></i> Refresh\r\n          </button>\r\n        </div>\r\n\r\n        {/* Stats Cards */}\r\n        <div className=\"stats-grid\">\r\n          {[\r\n            { \r\n              label: 'Total Sessions', \r\n              value: stats.totalSessions, \r\n              colorClass: 'stats-total', \r\n              icon: 'fas fa-comments' \r\n            },\r\n            { \r\n              label: 'Active Chats', \r\n              value: stats.activeSessions, \r\n              colorClass: 'stats-active', \r\n              icon: 'fas fa-circle' \r\n            },\r\n            { \r\n              label: 'Waiting for Agent', \r\n              value: stats.waitingSessions, \r\n              colorClass: 'stats-waiting', \r\n              icon: 'fas fa-clock' \r\n            },\r\n            { \r\n              label: 'Connection Status', \r\n              value: isConnected ? 'Online' : 'Offline', \r\n              colorClass: isConnected ? 'stats-online' : 'stats-offline', \r\n              icon: isConnected ? 'fas fa-wifi' : 'fas fa-wifi-slash' \r\n            }\r\n          ].map((stat, index) => (\r\n            <div key={index} className=\"stats-card\">\r\n              <div className={`stats-icon ${stat.colorClass}`}>\r\n                <i className={stat.icon}></i>\r\n              </div>\r\n              <div className={`stats-value ${stat.colorClass}`}>\r\n                {stat.value}\r\n              </div>\r\n              <div className=\"stats-label\">\r\n                {stat.label}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Filters and Search */}\r\n        <div className=\"filters-container\">\r\n          <div className=\"filter-buttons\">\r\n            {filterOptions.map((option) => (\r\n              <button\r\n                key={option.value}\r\n                onClick={() => setFilter(option.value)}\r\n                className={`filter-button ${filter === option.value ? 'active' : ''}`}\r\n              >\r\n                {option.label} ({option.count})\r\n              </button>\r\n            ))}\r\n          </div>\r\n          \r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Search sessions...\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            className=\"search-input\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Sessions List */}\r\n      <div className=\"sessions-content\">\r\n        {error && (\r\n          <div className=\"error-message\">\r\n            <i className=\"fas fa-exclamation-triangle error-icon\"></i>\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        {filteredSessions.length === 0 ? (\r\n          <div className=\"empty-state\">\r\n            <div className=\"empty-icon\">\r\n              <i className=\"fas fa-comments\"></i>\r\n            </div>\r\n            <h3 className=\"empty-title\">\r\n              No chat sessions found\r\n            </h3>\r\n            <p className=\"empty-description\">\r\n              {searchQuery ? 'Try adjusting your search terms' : 'Chat sessions will appear here when users start conversations'}\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"sessions-grid\">\r\n            {filteredSessions.map((session) => (\r\n              <div\r\n                key={session._id}\r\n                className=\"session-card\"\r\n                onClick={() => navigateToChat(session._id)}\r\n              >\r\n                <div className=\"session-content\">\r\n                  <div className=\"user-avatar-container\">\r\n                    <img\r\n                      src={getProfileImageSrc(session.userInfo?.photo, !session.userInfo?.userId)}\r\n                      alt=\"User\"\r\n                      className=\"user-avatar\"\r\n                    />\r\n                    <div className={`status-indicator ${getIndicatorClass(session.status)}`} />\r\n                  </div>\r\n                  \r\n                  <div className=\"session-details\">\r\n                    <div className=\"session-header\">\r\n                      <div className=\"user-info\">\r\n                        <h3>\r\n                          {session.userInfo?.firstName || 'Guest User'} {session.userInfo?.lastName || ''}\r\n                        </h3>\r\n                        <p>\r\n                          {session.userInfo?.email || 'No email provided'}\r\n                        </p>\r\n                      </div>\r\n                      \r\n                      <div className=\"session-meta\">\r\n                        {session.unreadCount > 0 && (\r\n                          <span className=\"unread-count\">\r\n                            {session.unreadCount}\r\n                          </span>\r\n                        )}\r\n                        \r\n                        <span className={`status-badge ${getStatusClass(session.status)}`}>\r\n                          {session.status}\r\n                        </span>\r\n                        \r\n                        <span className=\"timestamp\">\r\n                          {formatTime(session.lastMessage?.timestamp || session.createdAt)}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"last-message\">\r\n                      <p>\r\n                        <strong>\r\n                          {session.lastMessage?.senderType === 'user' ? 'User: ' : 'Agent: '}\r\n                        </strong>\r\n                        {session.lastMessage?.message || 'No messages yet'}\r\n                      </p>\r\n                    </div>\r\n                    \r\n                    <div className=\"session-footer\">\r\n                      <div className=\"session-info\">\r\n                        <span>\r\n                          <i className=\"fas fa-calendar-alt\"></i>\r\n                          {new Date(session.createdAt).toLocaleDateString()}\r\n                        </span>\r\n                        {session.agent && (\r\n                          <span>\r\n                            <i className=\"fas fa-user\"></i>\r\n                            {session.agent.firstname} {session.agent.lastname}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      <div className=\"session-actions\">\r\n                        {session.status === 'waiting' && (\r\n                          <button\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              assignSession(session._id);\r\n                            }}\r\n                            className=\"action-button take-session-button\"\r\n                          >\r\n                            <i className=\"fas fa-hand-paper\"></i> Take Session\r\n                          </button>\r\n                        )}\r\n                        \r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            navigateToChat(session._id);\r\n                          }}\r\n                          className=\"action-button open-chat-button\"\r\n                        >\r\n                          <i className=\"fas fa-comments\"></i> Open Chat\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminChatList;\r\n"],"names":["AdminChatList","navigate","useNavigate","socket","isConnected","useSocket","auth","useAuth","adminUser","user","sessions","setSessions","useState","filteredSessions","setFilteredSessions","isLoading","setIsLoading","error","setError","filter","setFilter","searchQuery","setSearchQuery","stats","setStats","totalSessions","activeSessions","waitingSessions","getProfileImageSrc","useCallback","userPhoto","arguments","length","undefined","startsWith","formatTime","timestamp","diff","Date","now","getTime","minutes","Math","floor","hours","days","loadSessions","async","response","API","get","data","success","sessionData","err","_err$response","_err$response2","console","status","_err$response3","_err$response3$data","message","useEffect","role","filtered","session","trim","query","toLowerCase","_session$userInfo","_session$userInfo$fir","_session$userInfo2","_session$userInfo2$la","_session$userInfo3","_session$userInfo3$em","_session$lastMessage","_session$lastMessage$","userInfo","firstName","includes","lastName","email","lastMessage","handleNewSession","prev","handleSessionUpdate","updatedSession","map","_id","handleNewMessage","sessionId","unreadCount","senderType","on","off","assignSession","post","adminId","agent","navigateToChat","getStatusClass","getIndicatorClass","filterOptions","value","label","count","_jsxs","className","children","_jsx","onClick","colorClass","icon","stat","index","option","type","placeholder","onChange","e","target","_session$userInfo4","_session$userInfo5","_session$userInfo6","_session$userInfo7","_session$userInfo8","_session$lastMessage2","_session$lastMessage3","_session$lastMessage4","src","photo","userId","alt","createdAt","toLocaleDateString","firstname","lastname","stopPropagation"],"sourceRoot":""}